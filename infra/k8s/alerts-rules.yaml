apiVersion: monitoring.googleapis.com/v1
kind: Rules
metadata:
  name: ech-0278-alerts
  namespace: ech-0278
spec:
  groups:
    - name: ech-0278-availability
      interval: 30s
      rules:
        - alert: Ech0278DeploymentUnavailable
          expr: sum(kube_deployment_status_replicas_unavailable{namespace="ech-0278",deployment=~"backend|frontend"}) > 0
          for: 10m
          labels:
            severity: critical
          annotations:
            summary: eCH-0278 deployment has unavailable replicas
            description: Backend or frontend has unavailable replicas for over 10 minutes.
        - alert: Ech0278PodCrashLoopBackOff
          expr: max_over_time(kube_pod_container_status_waiting_reason{namespace="ech-0278",reason="CrashLoopBackOff",pod=~"(backend|frontend)-.*"}[5m]) > 0
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: eCH-0278 pod is in CrashLoopBackOff
            description: One or more backend/frontend pods have been CrashLooping for at least 5 minutes.
        - alert: Ech0278HpaAtMaxReplicas
          expr: kube_horizontalpodautoscaler_status_current_replicas{namespace="ech-0278",horizontalpodautoscaler=~"backend|frontend"} >= kube_horizontalpodautoscaler_spec_max_replicas{namespace="ech-0278",horizontalpodautoscaler=~"backend|frontend"}
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: eCH-0278 HPA reached max replicas
            description: Backend or frontend HPA is at max replicas for at least 10 minutes.
